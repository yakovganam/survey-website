<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×ª×•×¦××•×ª ×‘×–××Ÿ ×××ª | ×‘×—×™×¨×•×ª 2026</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Results Header -->
  <header class="results-header">
    <div class="results-header-content">
      <div class="results-title-group">
        <h1>ğŸ“Š ×ª×•×¦××•×ª ×‘×–××Ÿ ×××ª</h1>
        <p class="results-meta" id="meta">×˜×•×¢×Ÿ × ×ª×•× ×™×...</p>
      </div>
      <div style="display: flex; gap: 12px;">
        <button class="btn-primary" id="refresh-btn">×¨×¢× ×Ÿ ğŸ”„</button>
        <a href="index.html" class="btn-secondary">×—×–×¨×” ×œ×¡×§×¨</a>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      <!-- Main Results Card -->
      <section class="results-card">
        <div class="results-controls">
          <div>
            <h2 id="survey-title" style="font-size: 1.75rem; font-weight: 700; color: var(--gray-900); margin-bottom: 8px;">
              ×¡×§×¨ ×‘×—×™×¨×•×ª 2026
            </h2>
            <p style="color: var(--gray-600); font-size: 0.95rem;">
              ×—×™×©×•×‘ ×× ×“×˜×™× ×œ×¤×™ ×©×™×˜×ª ×”×©××¨×™×•×ª ×”×’×“×•×œ×•×ª (Hare) Â· ××—×•×– ×—×¡×™××” 3.25%
            </p>
          </div>
        </div>
        
        <div class="results-table">
          <div id="results-content" class="loading">
            <div class="spinner"></div>
            <p style="margin-right: 16px;">×˜×•×¢×Ÿ ×ª×•×¦××•×ª...</p>
          </div>
        </div>
      </section>

      <!-- Seats Summary -->
      <section class="results-card">
        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 24px; color: var(--gray-900);">
          ğŸ“ˆ ×¡×™×›×•× ×× ×“×˜×™×
        </h3>
        <div id="seats-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
          <!-- Will be populated by JS -->
        </div>
      </section>

      <!-- Admin Data Table -->
      <section class="results-card" style="background: var(--gray-50);">
        <h3 style="font-size: 1.35rem; font-weight: 700; margin-bottom: 16px; color: var(--gray-900);">
          ğŸ”§ × ×ª×•× ×™× ××¤×•×¨×˜×™× (Admin)
        </h3>
        <div class="admin-table" id="admin-table">
          <!-- Will be populated by JS -->
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>×¡×§×¨ ×‘×—×™×¨×•×ª 2026</h4>
          <p>××¢×¨×›×ª ×¡×§×¨×™× ××ª×§×“××ª ×œ×‘×—×™×¨×•×ª ×”×›× ×¡×ª ×”-26</p>
        </div>
        <div class="footer-section">
          <h4>×§×™×©×•×¨×™×</h4>
          <ul class="footer-links">
            <li><a href="index.html">×“×£ ×”×‘×™×ª</a></li>
            <li><a href="results.html">×ª×•×¦××•×ª</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>××™×“×¢ ×˜×›× ×™</h4>
          <p class="footer-note">×—×™×©×•×‘ ×× ×“×˜×™× ×œ×¤×™ ×—×•×§ ×”×‘×—×™×¨×•×ª ×”×™×©×¨××œ×™ Â· ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×›×œ 15 ×©× ×™×•×ª</p>
        </div>
      </div>
      <div class="footer-bottom">
        <small>Â© 2026 ×¡×§×¨ ×‘×—×™×¨×•×ª ×™×©×¨××œ Â· ×œ× ×¨×©××™</small>
      </div>
    </div>
  </footer>

  <script>
    const API_BASE = '/api';
    const url = new URL(location.href);
    const surveyId = url.searchParams.get('id') || '1';

    /**
     * Load and display results
     */
    async function loadResults() {
      const resultsContent = document.getElementById('results-content');
      
      try {
        const response = await fetch(`${API_BASE}/surveys/${encodeURIComponent(surveyId)}/results`);
        
        if (!response.ok) {
          throw new Error('Failed to load results');
        }
        
        const data = await response.json();
        
        // Update header info
        document.getElementById('survey-title').textContent = data.survey?.title || '×ª×•×¦××•×ª ×¡×§×¨';
        document.getElementById('meta').textContent = 
          `××¡×¤×¨ ××¦×‘×™×¢×™×: ${data.totalVotes} Â· ××—×•×– ×—×¡×™××”: ${data.thresholdPercent || 3.25}%`;
        
        // Render results
        if (!data.results || data.results.length === 0) {
          resultsContent.innerHTML = `
            <div style="text-align: center; padding: 60px 20px; color: var(--gray-600);">
              <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ—³ï¸</div>
              <p style="font-size: 1.1rem;">××™×Ÿ ×¢×“×™×™×Ÿ ×ª×•×¦××•×ª ×œ×”×¦×’×”</p>
              <p style="margin-top: 8px; font-size: 0.95rem;">×”×™×” ×”×¨××©×•×Ÿ ×œ×”×¦×‘×™×¢!</p>
            </div>
          `;
          document.getElementById('seats-summary').innerHTML = '';
          document.getElementById('admin-table').innerHTML = '';
          return;
        }
        
        renderResultsTable(data.results);
        renderSeatsSummary(data.results, data.totalVotes);
        renderAdminTable(data.results, data.totalVotes);
        
      } catch (error) {
        console.error('Error loading results:', error);
        resultsContent.innerHTML = `
          <div style="text-align: center; padding: 40px; color: #EF4444;">
            <p style="font-size: 1.1rem; font-weight: 600;">×©×’×™××” ×‘×˜×¢×™× ×ª ×”×ª×•×¦××•×ª</p>
            <p style="margin-top: 8px; color: var(--gray-600);">×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨</p>
          </div>
        `;
      }
    }

    /**
     * Render main results table with bars
     */
    function renderResultsTable(results) {
      const container = document.getElementById('results-content');
      const maxPercent = Math.max(...results.map(r => r.percent || 0), 1);
      
      let html = `
        <div class="result-row" style="font-weight: 700; font-size: 0.95rem; padding: 12px 0;">
          <div>××¤×œ×’×”</div>
          <div>××—×•×–×™ ×ª××™×›×”</div>
          <div style="text-align: center;">×× ×“×˜×™×</div>
          <div style="text-align: center;">×§×•×œ×•×ª</div>
        </div>
      `;
      
      results.forEach((result, index) => {
        const barWidth = (result.percent / maxPercent) * 100;
        const partyColor = getPartyColor(index);
        
        html += `
          <div class="result-row" style="animation: fadeInUp 0.4s ease ${index * 0.05}s backwards;">
            <div class="result-party">${result.party}</div>
            <div class="bar-container">
              <div class="bar" style="width: ${barWidth}%; background: ${partyColor};">
                ${result.percent.toFixed(1)}%
              </div>
            </div>
            <div class="result-seats">${result.seats}</div>
            <div class="result-votes">${result.votes}</div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    /**
     * Render seats summary cards
     */
    function renderSeatsSummary(results, totalVotes) {
      const container = document.getElementById('seats-summary');
      const totalSeats = results.reduce((sum, r) => sum + r.seats, 0);
      const qualifiedParties = results.filter(r => r.seats > 0).length;
      
      container.innerHTML = `
        <div style="background: linear-gradient(135deg, #0066FF, #0052CC); color: white; padding: 24px; border-radius: var(--radius-md); text-align: center;">
          <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 8px;">${totalSeats}</div>
          <div style="opacity: 0.95;">×¡×”"×› ×× ×“×˜×™× ××—×•×œ×§×™×</div>
        </div>
        <div style="background: linear-gradient(135deg, #00B8FF, #0066FF); color: white; padding: 24px; border-radius: var(--radius-md); text-align: center;">
          <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 8px;">${qualifiedParties}</div>
          <div style="opacity: 0.95;">××¤×œ×’×•×ª ×©×¢×‘×¨×• ××ª ××—×•×– ×”×—×¡×™××”</div>
        </div>
        <div style="background: var(--white); border: 2px solid var(--primary-blue); padding: 24px; border-radius: var(--radius-md); text-align: center;">
          <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 8px; color: var(--primary-blue);">${totalVotes}</div>
          <div style="color: var(--gray-600);">×¡×”"×› ×§×•×œ×•×ª</div>
        </div>
      `;
    }

    /**
     * Render admin data table
     */
    function renderAdminTable(results, totalVotes) {
      const container = document.getElementById('admin-table');
      
      let html = `
        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: var(--radius-md); overflow: hidden;">
          <thead>
            <tr style="background: var(--gray-100);">
              <th style="text-align: right; padding: 12px 16px; font-weight: 700;">××¤×œ×’×”</th>
              <th style="text-align: right; padding: 12px 16px; font-weight: 700;">×§×•×œ×•×ª</th>
              <th style="text-align: right; padding: 12px 16px; font-weight: 700;">××—×•×–</th>
              <th style="text-align: right; padding: 12px 16px; font-weight: 700;">×× ×“×˜×™×</th>
              <th style="text-align: right; padding: 12px 16px; font-weight: 700;">×¡×˜×˜×•×¡</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      results.forEach(result => {
        const passed = result.seats > 0;
        const statusText = passed ? 'âœ… ×¢×‘×¨' : 'âŒ ×œ× ×¢×‘×¨';
        const statusColor = passed ? 'var(--primary-blue)' : 'var(--gray-400)';
        
        html += `
          <tr style="border-bottom: 1px solid var(--gray-100);">
            <td style="padding: 12px 16px; font-weight: 600;">${result.party}</td>
            <td style="padding: 12px 16px;">${result.votes}</td>
            <td style="padding: 12px 16px;">${result.percent.toFixed(2)}%</td>
            <td style="padding: 12px 16px; font-weight: 700; color: ${statusColor};">${result.seats}</td>
            <td style="padding: 12px 16px; color: ${statusColor}; font-weight: 600;">${statusText}</td>
          </tr>
        `;
      });
      
      html += `
          </tbody>
        </table>
      `;
      
      container.innerHTML = html;
    }

    /**
     * Get color for party (gradient across spectrum)
     */
    function getPartyColor(index) {
      const colors = [
        'linear-gradient(90deg, #0066FF, #3385FF)',
        'linear-gradient(90deg, #00B8FF, #00D4FF)',
        'linear-gradient(90deg, #0052CC, #0066FF)',
        'linear-gradient(90deg, #3385FF, #66A3FF)',
        'linear-gradient(90deg, #0099FF, #00B8FF)',
        'linear-gradient(90deg, #0066FF, #0099FF)',
        'linear-gradient(90deg, #004C99, #0066FF)',
      ];
      return colors[index % colors.length];
    }

    // Event listeners
    document.getElementById('refresh-btn').addEventListener('click', loadResults);

    // Auto-refresh every 15 seconds
    setInterval(loadResults, 15000);

    // Initial load
    loadResults();
  </script>
</body>
</html>
